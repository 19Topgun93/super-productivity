<div class="wrapper"
     *ngIf="task.id"
     [@taskAdditionalInfoTaskChange]="task.id">

  <!--  <header class="task-title-wrapper">-->
  <!--    <button mat-icon-button-->
  <!--            (click)="close()">-->
  <!--      <mat-icon>close</mat-icon>-->
  <!--    </button>-->
  <!--    <h2 class="task-title"-->
  <!--        (editFinished)="updateTaskTitleIfChanged($event.isChanged, $event.newVal)"-->
  <!--        [value]="task.title"-->
  <!--        [isResetAfterEdit]="true"-->
  <!--        contenteditable="true"-->
  <!--        contentEditableOnClick-->
  <!--        tabindex="2">{{task.title}}</h2>-->
  <!--    <button mat-icon-button>-->
  <!--      <mat-icon>more_vert</mat-icon>-->
  <!--    </button>-->
  <!--  </header>-->


  <!--  <mat-expansion-panel *ngIf="task.subTasks?.length">-->
  <!--    <mat-expansion-panel-header>-->
  <!--      <mat-panel-title>-->
  <!--        <mat-icon class="panel-header-icon">list</mat-icon>-->
  <!--        <span>Sub Tasks ({{task.subTasks?.length}})</span>-->
  <!--      </mat-panel-title>-->
  <!--    </mat-expansion-panel-header>-->
  <!--    <div class="panel-content-wrapper sub-tasks">-->
  <!--      <div *ngIf="task.subTasks && task.subTasks.length"-->
  <!--           class="sub-tasks">-->
  <!--        &lt;!&ndash;      <button (click)="toggleSubTaskMode()"&ndash;&gt;-->
  <!--        &lt;!&ndash;              *ngIf="task.subTasks && task.subTasks.length"&ndash;&gt;-->
  <!--        &lt;!&ndash;              class="toggle-sub-tasks-btn ico-btn mat-elevation-z2"&ndash;&gt;-->
  <!--        &lt;!&ndash;              color=""&ndash;&gt;-->
  <!--        &lt;!&ndash;              mat-mini-fab&ndash;&gt;-->
  <!--        &lt;!&ndash;              tabindex="2"&ndash;&gt;-->
  <!--        &lt;!&ndash;              [title]="T.F.TASK.CMP.TOGGLE_SUB_TASK_VISIBILITY|translate">&ndash;&gt;-->
  <!--        &lt;!&ndash;        <mat-icon *ngIf="(task._showSubTasksMode===ShowSubTasksMode.HideAll)">add&ndash;&gt;-->
  <!--        &lt;!&ndash;        </mat-icon>&ndash;&gt;-->
  <!--        &lt;!&ndash;        <mat-icon *ngIf="(task._showSubTasksMode!==ShowSubTasksMode.HideAll)"&ndash;&gt;-->
  <!--        &lt;!&ndash;                  [class.isHideDoneTasks]="(task._showSubTasksMode===ShowSubTasksMode.HideDone)">remove&ndash;&gt;-->
  <!--        &lt;!&ndash;        </mat-icon>&ndash;&gt;-->
  <!--        &lt;!&ndash;      </button>&ndash;&gt;-->
  <!--        <task-list *ngIf="task.subTasks?.length"-->
  <!--                   [@expand]-->
  <!--                   [isHideAll]="(task._showSubTasksMode!==ShowSubTasksMode.Show)"-->
  <!--                   [isHideDone]="(task._showSubTasksMode===ShowSubTasksMode.HideDone)"-->
  <!--                   [listModelId]="task.id"-->
  <!--                   [parentId]="task.id"-->
  <!--                   [tasks]="task.subTasks"-->
  <!--                   listId="SUB"></task-list>-->
  <!--      </div>-->
  <!--    </div>-->
  <!--  </mat-expansion-panel>-->

  <task-additional-info-item
    class="input-item --estimate"
    *ngIf="task.parentId"
    [inputIcon]="'arrow_forward'"
    (editActionTriggered)="taskService.setSelectedId(task.parentId)"
    (keyPress)="onItemKeyPress($event)"
    (collapseParent)="collapseParent()"
  >
    <ng-container input-title>
      <mat-icon>subdirectory_arrow_right</mat-icon>
      <span style="white-space: nowrap">Parent</span>
    </ng-container>
    <ng-container input-value
                  style="white-space: nowrap; overflow: hidden; display: inline-block; width: 200px;text-overflow: ellipsis">
      {{(taskService.getById$(task.parentId)|async)?.title}}
    </ng-container>

  </task-additional-info-item>

  <task-additional-info-item
    class="input-item --estimate"
    *ngIf="!task.subTasks?.length"
    [inputIcon]="'edit'"
    (editActionTriggered)="estimateTime()"
    (keyPress)="onItemKeyPress($event)"
    (collapseParent)="collapseParent()"
  >
    <ng-container input-title>
      <mat-icon>timer</mat-icon>
      <span>Time</span>
    </ng-container>
    <ng-container input-value>
          <span class="time-val">
            <span [innerHTML]="task.timeSpent|msToString"></span>
          </span>
      <span class="separator">/</span>
      <span [innerHTML]="task.timeEstimate|msToString"
            class="time-val"></span>

      <ng-container input-additional>
        <progress-bar [cssClass]="false &&'bg-accent'"
                      [progress]="progress"></progress-bar>
      </ng-container>
    </ng-container>
  </task-additional-info-item>

  <task-additional-info-item
    class="input-item"
    *ngIf="!task.repeatCfgId"
    [inputIcon]="task.reminderId ? 'edit': 'add'"
    (editActionTriggered)="editReminder()"
    (keyPress)="onItemKeyPress($event)"
    (collapseParent)="collapseParent()"
  >
    <ng-container input-title>
      <mat-icon>alarm</mat-icon>
      <span *ngIf="task.reminderId">Reminder</span>
      <span *ngIf="!task.reminderId">Schedule Task</span>
    </ng-container>
    <ng-container input-value>
      <div class="reminder-value"
           matTooltipPosition="left"
           *ngIf="reminderData$|async as reminderData"
           [matTooltip]="reminderData.remindAt|date:'short'">
        {{reminderData.remindAt|humanizeTimestamp}}
      </div>
    </ng-container>
  </task-additional-info-item>

  <task-additional-info-item
    [type]="'panel'"
    *ngIf="task.issueData"
    [expanded]="true"
    (keyPress)="onItemKeyPress($event)"
    (collapseParent)="collapseParent()"
  >
    <ng-container panel-header>
      <issue-header [task]="task"></issue-header>
    </ng-container>

    <ng-container panel-content>
      <issue-content [task]="task"
                     class="panel-content-wrapper issue-content-wrapper"></issue-content>
    </ng-container>
  </task-additional-info-item>


  <task-additional-info-item
    [type]="'panel'"
    [expanded]="task.notes || (!(task.issueId) && !task.attachmentIds?.length)"
    (keyPress)="onItemKeyPress($event)"
    (collapseParent)="collapseParent()"
    (editActionTriggered)="isFocusNotes=true"
  >
    <ng-container panel-header>
      <mat-icon *ngIf="task.notes"
      >chat
      </mat-icon>
      <mat-icon *ngIf="!task.notes"
      >chat_bubble_outline
      </mat-icon>
      <span>{{T.F.TASK.ADDITIONAL_INFO.NOTES|translate}}</span>
    </ng-container>

    <ng-container panel-content>
      <inline-markdown (changed)="changeTaskNotes($event); isFocusNotes=false"
                       (blur)="isFocusNotes=false"
                       (blurred)="isFocusNotes=false"
                       [isFocus]="isFocusNotes"
                       [model]="task.notes"
                       [isShowControls]="true"></inline-markdown>
    </ng-container>
  </task-additional-info-item>


  <task-additional-info-item
    [type]="'panel'"
    [expanded]="true"
    *ngIf="issueAttachments?.length || (localAttachments$|async)?.length"
    (keyPress)="onItemKeyPress($event)"
    (collapseParent)="collapseParent()"
  >
    <ng-container panel-header>
      <mat-icon>attachment</mat-icon>
      <span>{{T.F.TASK.ADDITIONAL_INFO.ATTACHMENTS|translate:{nr: issueAttachments?.length + (localAttachments$|async)?.length} }}</span>
    </ng-container>

    <ng-container panel-content>
      <div class="panel-content-wrapper attachment-list-panel-content-wrapper">
        <ng-container *ngIf="task.issueType">
          <h3 class="mat-h3"
              style="margin-bottom: 0;">{{T.F.TASK.ADDITIONAL_INFO.ISSUE_TYPE_ATTACHMENTS|translate:{issueType: task.issueType} }}</h3>
          <attachment-list [attachments]="issueAttachments"
                           [isDisableControls]="true"></attachment-list>
        </ng-container>
        <h3 class="mat-h3"
            style="margin-bottom: 0;">{{T.F.TASK.ADDITIONAL_INFO.LOCAL_ATTACHMENTS|translate}}</h3>
        <attachment-list [attachments]="localAttachments$|async"></attachment-list>
      </div>
    </ng-container>
  </task-additional-info-item>

  <task-additional-info-item
    class="input-item"
    *ngIf="!issueAttachments?.length && !(localAttachments$|async)?.length"
    [inputIcon]="'add'"
    (editActionTriggered)="addAttachment()"
    (keyPress)="onItemKeyPress($event)"
    (collapseParent)="collapseParent()"
  >
    <ng-container input-title>
      <mat-icon>attachment</mat-icon>
      <span>Add attachment</span>
    </ng-container>
    <ng-container input-value>
    </ng-container>
  </task-additional-info-item>


  <task-additional-info-item
    class="input-item"
    *ngIf="!task.parentId && !task.issueId"
    [inputIcon]="task.repeatCfgId ? 'edit': 'add'"
    (editActionTriggered)="editTaskRepeatCfg()"
    (keyPress)="onItemKeyPress($event)"
    (collapseParent)="collapseParent()"
  >
    <ng-container input-title>
      <mat-icon
        style="transform: rotate(45deg);">repeat
      </mat-icon>
      <span>Repeat</span>
    </ng-container>
    <ng-container input-value>
      <div class="reminder-value"
           matTooltipPosition="left"
           *ngIf="repeatCfgDays$|async as repeatCfgDays">
        {{repeatCfgDays}}
      </div>
    </ng-container>
  </task-additional-info-item>

</div>
