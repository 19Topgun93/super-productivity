<ul class="task-list"
    as-sortable="vm.dragControlListeners"
    ng-model="vm.tasks">
  <li class="task"
      as-sortable-item
      ng-class="{'is-current': vm.currentTask.id === task.id, 'is-done':task.isDone}"
      ng-repeat="task in vm.tasks|limitTo:vm.limitTo|filter:vm.filter track by task.id">
    <div class="first-line"
         layout="row"
         as-sortable-item-handle
         layout-align="center center">
      <ng-md-icon class="handle"
                  flex="none"
                  icon="drag_handle"></ng-md-icon>

      <md-button class="md-icon-button"
                 aria-label="mark as current"
                 ng-click="vm.currentTask=task"
                 ng-show="vm.allowTaskSelection">
        <ng-md-icon icon="play_circle_outline"
                    aria-label="mark as current"></ng-md-icon>
      </md-button>

      <div class="title"
           flex="auto"
           layout="row"
           layout-align="center center">

        <form ng-show="task.showEdit && !task.isDone"
              ng-submit="task.showEdit=false;">
          <input type="text"
                 ng-disabled="task.isDone"
                 ng-model="task.title"
                 ng-blur="task.showEdit=false;"
                 md-auto-focus
                 md-autofocus>
        </form>
        <span class="text"
              ng-show="!task.showEdit || task.isDone"
              ng-click="task.showEdit = true;">{{ task.title }}</span>
      </div>

      <div class="time"
           data-ng-show="task.timeEstimate || task.timeSpend">
        {{ task.timeSpend |duration }} <span ng-show="task.timeEstimate">/</span>
        {{ task.timeEstimate |duration }}
      </div>

      <md-button class="md-icon-button"
                 aria-label="time estimation"
                 ng-click="vm.estimateTime(task)">
        <ng-md-icon icon="access_time"
                    aria-label="time estimation"></ng-md-icon>
      </md-button>

      <md-button class="md-icon-button"
                 aria-label="notes"
                 ng-class="{'is-active':task.showNotes}"
                 ng-click="task.showNotes=!task.showNotes">
        <ng-md-icon icon="mode_comment"
                    aria-label="notes"></ng-md-icon>
      </md-button>
      <md-button class="md-icon-button"
                 aria-label="delete"
                 ng-click="vm.deleteTask(task.id)">
        <ng-md-icon icon="delete_forever"
                    aria-label="delete"
                    style="fill: red;"></ng-md-icon>
      </md-button>

      <md-checkbox ng-model="task.isDone"
                   ng-change="vm.onTaskDoneChanged(task)"
                   aria-label="un-/mark as done">
      </md-checkbox>

    </div>

    <div class="notes"
         flex="100"
         ng-if="task.showNotes===true">
      <label>Notes</label>
      <textarea ng-model="task.notes"
                rows="5"
                md-auto-focus
                md-select-on-focus></textarea>
    </div>
  </li>
</ul>
